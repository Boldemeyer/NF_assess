Timing = c("8/10 - 9/30", "6/10 - 10/15", "6/10 - 10/15"),
Minimum = c("3.3", "4.5", "4.5"),
Optimum = c("7.2-14.5", "10-16", "10-18"),
Maximum = c("18", "20", "19"),
Acute = c("20", "22", "22")) %>%
kable(booktabs = T,
align = "ccccccc",
caption = "Life stage timing, and minimum, optimum, maximu, and acute temperature (Celcius) thresholds for summer life stages of Chinook salmon and steelhead, adopted from Carter (2005). All temperatures are expressed as the 7-day Maximum Weekly Maximum Temperature (MWMT).") %>%
kable_styling(full_width = F,
position = "center",
bootstrap_options = c("striped", "condensed"))
norwest_df = NF_rch_sf %>%
select(S2_02_11,
S30_2040D,
S32_2080D) %>%
mutate(S2_02_11 = replace(S2_02_11, S2_02_11 == -9999.00, NA),
S30_2040D = replace(S30_2040D, S30_2040D == -9999.00, NA),
S32_2080D = replace(S32_2080D, S32_2080D == -9999.00, NA)) %>%
pivot_longer(cols = c("S2_02_11",
"S30_2040D",
"S32_2080D"),
names_to = "scenario",
values_to = "temp_c")
View(norwest_df)
temp_thresh_df = norwest_df %>%
mutate(ao_chnk_spawn_cu = ifelse(temp_df > 14.5, T, F))
temp_thresh_df = norwest_df %>%
mutate(ao_chnk_spawn_cu = ifelse(temp_c > 14.5, T, F))
View(temp_thresh_df)
temp_thresh_df = norwest_df %>%
pivot_wider()
temp_thresh_df = norwest_df %>%
pivot_wider(names_from = scenario,
values_from = temp_c)
temp_thresh_df = norwest_df %>%
pivot_wider(names_from = scenario,
values_from = temp_c)
View(norwest_df)
library(tidyverse)
temp_thresh_df = norwest_df %>%
pivot_wider(names_from = scenario,
values_from = temp_c)
View(norwest_df)
View(temp_thresh_df)
temp_thresh_df = NF_rch_sf %>%
select(S2_02_11,
S30_2040D,
S32_2080D) %>%
mutate(S2_02_11 = replace(S2_02_11, S2_02_11 == -9999.00, NA),
S30_2040D = replace(S30_2040D, S30_2040D == -9999.00, NA),
S32_2080D = replace(S32_2080D, S32_2080D == -9999.00, NA))
View(norwest_df)
temp_thresh_df = norwest_df %>%
expand(c("x", "y", "z"))
View(temp_thresh_df)
temp_thresh_df = norwest_df %>%
expand(scenario, temp_c, c("x", "y", "z"))
View(temp_thresh_df)
str(norwest_df)
temp_thresh_df = norwest_df %>%
expand(geometry, scenario, temp_c, c("x", "y", "z"))
View(norwest_df)
spec_ls = c("Chinook Spawn", "Chinook Rear", "Steelhead Rear")
thresh_df = norwest_p() %>%
expand(spec_ls)
spec_ls = c("Chinook Spawn", "Chinook Rear", "Steelhead Rear")
thresh_df = norwest_p %>%
expand(spec_ls)
thresh_df = norwest_df %>%
expand(spec_ls)
View(thresh_df)
thresh_df = norwest_df %>%
left_join(spec_ls)
thresh_df = norwest_df %>%
expand.grid(spec_ls)
View(thresh_df)
View(thresh_df)
thresh_df = norwest_df %>%
expand.grid(spec_ls)
thresh_df
thresh_df = norwest_df %>%
crossing(spec_ls)
spec_ls = c("Chinook Spawn", "Chinook Rear", "Steelhead Rear")
thresh_df = norwest_df %>%
crossing(spec_ls)
thresh_df = norwest_df %>%
crossing(scenario, spec_ls)
library(magrittr)
norwest_df = NF_rch_sf %>%
select(S2_02_11,
S30_2040D,
S32_2080D) %>%
mutate(S2_02_11 = replace(S2_02_11, S2_02_11 == -9999.00, NA),
S30_2040D = replace(S30_2040D, S30_2040D == -9999.00, NA),
S32_2080D = replace(S32_2080D, S32_2080D == -9999.00, NA)) %>%
pivot_longer(cols = c("S2_02_11",
"S30_2040D",
"S32_2080D"),
names_to = "scenario",
values_to = "temp_c")
thresh_df = norwest_df %>%
crossing(scenario, spec_ls)
thresh_df = norwest_df %>%
crossing(scenario, spec_ls)
thresh_df = norwest_df %>%
crossing(spec_ls)
thresh_df = norwest_df %>%
crossing(spec_ls = c("Chinook Spawn", "Chinook Rear", "Steelhead Rear"))
norwest_df
View(norwest_df)
thresh_df = norwest_df %>%
crossing(data.frame(spec_ls = c("Chinook Spawn", "Chinook Rear", "Steelhead Rear")))
View(norwest_df)
str(norwest_df)
thresh_df = norwest_df %>%
uncount()
thresh_df = norwest_df %>%
uncount(freq)
thresh_df = norwest_df %>%
uncount(temp_c)
thresh_df = norwest_df %>%
slice(rep(1:n(), each = 3))
View(thresh_df)
View(norwest_df)
thresh_df = norwest_df %>%
mutate(`Chinook Spawning` = ifelse(temp_c > 14.5, T, F))
View(thresh_df)
thresh_df = norwest_df %>%
mutate(`Chinook Spawning` = ifelse(temp_c > 14.5, T, F),
`Chinook Rear` = ifelse(temp_c > 16, T, F),
`Steelhead Rear` = ifelse(temp_c > 18, T, F))
View(thresh_df)
thresh_df = norwest_df %>%
mutate(`Chinook Spawning` = ifelse(temp_c > 14.5, T, F),
`Chinook Rearing` = ifelse(temp_c > 16, T, F),
`Steelhead Rearing` = ifelse(temp_c > 18, T, F)) %>%
pivot_longer(cols = c("Chinook Spawning",
"Chinook Rearing",
"Steelhead Rearing"),
names_to = "spec_ls",
values_to = "above_optimum")
tabyl(thresh_df, above_optimum)
View(norwest_df)
names(NF_rch_sf)
View(NF_rch_sf)
thresh_df = norwest_df %>%
mutate(`Chinook Spawning` = ifelse(temp_c > 14.5, T, F),
`Chinook Rearing` = ifelse(temp_c > 16, T, F),
`Steelhead Rearing` = ifelse(temp_c > 18, T, F)) %>%
pivot_longer(cols = c("Chinook Spawning",
"Chinook Rearing",
"Steelhead Rearing"),
names_to = "spec_ls",
values_to = "above_optimum") %>%
left_join(NF_rch_sf %>%
select(geometry,
reach_leng))
thresh_df = norwest_df %>%
mutate(`Chinook Spawning` = ifelse(temp_c > 14.5, T, F),
`Chinook Rearing` = ifelse(temp_c > 16, T, F),
`Steelhead Rearing` = ifelse(temp_c > 18, T, F)) %>%
pivot_longer(cols = c("Chinook Spawning",
"Chinook Rearing",
"Steelhead Rearing"),
names_to = "spec_ls",
values_to = "above_optimum") %>%
st_join(NF_rch_sf %>%
select(geometry,
reach_leng))
knitr::opts_chunk$set(
collapse = TRUE,
warning = FALSE,
message = FALSE,
echo = FALSE,
comment = "#>",
fig.path = "../figures/",
dpi = 600
)
options(knitr.kable.NA = '--')
# run this if running chunks directly
# for formatting
library(kableExtra)
library(ggpubr)
# for analysis
library(sf)
library(here)
library(tidyverse)
library(magrittr)
library(ggmap)
library(nngeo)
library(janitor)
theme_set(theme_pubr(x.text.angle = 45,
base_size = 8))
# NF Salmon QRF extrapolations
load(here("analysis/data/derived_data/NF_qrf_extrapolations.rda"))
# Project area polygons and 200m layer (with habitat attributes) within project area
load(here("analysis/data/derived_data/NF_spatial.rda"))
river_color = "lightskyblue1"
norwest_df = NF_rch_sf %>%
select(S2_02_11,
S30_2040D,
S32_2080D) %>%
mutate(S2_02_11 = replace(S2_02_11, S2_02_11 == -9999.00, NA),
S30_2040D = replace(S30_2040D, S30_2040D == -9999.00, NA),
S32_2080D = replace(S32_2080D, S32_2080D == -9999.00, NA)) %>%
pivot_longer(cols = c("S2_02_11",
"S30_2040D",
"S32_2080D"),
names_to = "scenario",
values_to = "temp_c")
norwest_p = norwest_df %>%
ggplot() +
geom_sf(data = NF_huc_sf %>%
st_union(),
fill = NA,
color = "gray50") +
geom_sf(color = river_color) +
geom_sf(data = norwest_df,
aes(color = temp_c),
size = 1) +
scale_color_viridis_c(option = "turbo") +
facet_wrap(~ scenario,
ncol = 3) +
theme_bw() +
theme(legend.position = "bottom",
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank()) +
labs(title = "NorWeST Stream Temperature Predictions",
color = expression("Temperature ("^o*"C)"))
norwest_p
thresh_df = norwest_df %>%
mutate(`Chinook Spawning` = ifelse(temp_c > 14.5, T, F),
`Chinook Rearing` = ifelse(temp_c > 16, T, F),
`Steelhead Rearing` = ifelse(temp_c > 18, T, F)) %>%
pivot_longer(cols = c("Chinook Spawning",
"Chinook Rearing",
"Steelhead Rearing"),
names_to = "spec_ls",
values_to = "above_optimum") %>%
# get reach length
st_join(NF_rch_sf %>%
select(geometry,
reach_leng))
View(thresh_df)
thresh_p = thresh_df %>%
ggplot() +
geom_sf(data = NF_huc_sf %>%
st_union(),
fill = NA,
color = "gray50") +
geom_sf(color = river_color)
thresh_p
thresh_df = norwest_df %>%
mutate(`Chinook Spawning` = ifelse(temp_c > 14.5, T, F),
`Chinook Rearing` = ifelse(temp_c > 16, T, F),
`Steelhead Rearing` = ifelse(temp_c > 18, T, F)) %>%
pivot_longer(cols = c("Chinook Spawning",
"Chinook Rearing",
"Steelhead Rearing"),
names_to = "spec_ls",
values_to = "above_optimum") %>%
mutate(above_optimum = above_optimum(replace(is.na(.), F)))
thresh_df = norwest_df %>%
mutate(`Chinook Spawning` = ifelse(temp_c > 14.5, T, F),
`Chinook Rearing` = ifelse(temp_c > 16, T, F),
`Steelhead Rearing` = ifelse(temp_c > 18, T, F)) %>%
pivot_longer(cols = c("Chinook Spawning",
"Chinook Rearing",
"Steelhead Rearing"),
names_to = "spec_ls",
values_to = "above_optimum") %>%
mutate(above_optimum = above_optimum(replace(is.na, F)))
thresh_df = norwest_df %>%
mutate(`Chinook Spawning` = ifelse(temp_c > 14.5, T, F),
`Chinook Rearing` = ifelse(temp_c > 16, T, F),
`Steelhead Rearing` = ifelse(temp_c > 18, T, F)) %>%
pivot_longer(cols = c("Chinook Spawning",
"Chinook Rearing",
"Steelhead Rearing"),
names_to = "spec_ls",
values_to = "above_optimum") %>%
mutate(above_optimum = replace_na(above_optimum, F))
thresh_df = norwest_df %>%
mutate(`Chinook Spawning` = ifelse(temp_c > 14.5, T, F),
`Chinook Rearing` = ifelse(temp_c > 16, T, F),
`Steelhead Rearing` = ifelse(temp_c > 18, T, F)) %>%
pivot_longer(cols = c("Chinook Spawning",
"Chinook Rearing",
"Steelhead Rearing"),
names_to = "spec_ls",
values_to = "above_optimum") %>%
mutate(above_optimum = replace_na(above_optimum, F)) %>%
# get reach length
st_join(NF_rch_sf %>%
select(geometry,
reach_leng))
thresh_p = thresh_df %>%
ggplot() +
geom_sf(data = NF_huc_sf %>%
st_union(),
fill = NA,
color = "gray50") +
geom_sf(color = river_color) +
geom_sf(data = thresh_df,
aes(color = above_optimum),
size = 1)
thresh_p
thresh_p = thresh_df %>%
ggplot() +
geom_sf(data = NF_huc_sf %>%
st_union(),
fill = NA,
color = "gray50") +
geom_sf(color = river_color) +
geom_sf(data = thresh_df,
aes(color = above_optimum),
size = 1) +
facet_wrap(spec_ls ~ scenario)
thresh_p
thresh_p = thresh_df %>%
ggplot() +
geom_sf(data = NF_huc_sf %>%
st_union(),
fill = NA,
color = "gray50") +
geom_sf(color = river_color) +
geom_sf(data = thresh_df,
aes(color = above_optimum),
size = 1) +
facet_grid(spec_ls ~ scenario)
thresh_p
thresh_p = thresh_df %>%
ggplot() +
geom_sf(data = NF_huc_sf %>%
st_union(),
fill = NA,
color = "gray50") +
geom_sf(color = river_color) +
geom_sf(data = thresh_df,
aes(color = above_optimum),
size = 1) +
facet_grid(spec_ls ~ scenario) +
theme_classic()
thresh_p
thresh_p = thresh_df %>%
ggplot() +
geom_sf(data = NF_huc_sf %>%
st_union(),
fill = NA,
color = "gray50") +
geom_sf(color = river_color) +
geom_sf(data = thresh_df,
aes(color = above_optimum),
size = 1) +
facet_grid(spec_ls ~ scenario) +
theme_classic() +
theme(legend.position = "bottom",
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank())
thresh_p
thresh_p = thresh_df %>%
ggplot() +
geom_sf(data = NF_huc_sf %>%
st_union(),
fill = NA,
color = "gray50") +
geom_sf(color = river_color) +
geom_sf(data = thresh_df,
aes(color = above_optimum),
size = 1) +
facet_grid(spec_ls ~ scenario) +
theme_classic() +
theme(legend.position = "top",
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank()) +
labs(color = "Above Optimum Temperature")
thresh_p
thresh_p
thresh_p = thresh_df %>%
ggplot() +
geom_sf(data = NF_huc_sf %>%
st_union(),
fill = NA,
color = "gray50") +
#geom_sf(color = river_color) +
geom_sf(data = thresh_df,
aes(color = above_optimum),
size = 1) +
facet_grid(spec_ls ~ scenario) +
theme_classic() +
theme(legend.position = "top",
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank()) +
labs(color = "Above Optimum Temperature")
thresh_p
thresh_p = thresh_df %>%
ggplot() +
geom_sf(data = NF_huc_sf %>%
st_union(),
fill = NA,
color = "gray50") +
#geom_sf(color = river_color) +
geom_sf(data = thresh_df,
aes(color = above_optimum),
size = 1) +
scale_fill_manual(values = c("FALSE" = river_color,
"TRUE" = "red")) +
facet_grid(spec_ls ~ scenario) +
theme_classic() +
theme(legend.position = "top",
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank()) +
labs(color = "Above Optimum Temperature")
thresh_p
thresh_p = thresh_df %>%
ggplot() +
geom_sf(data = NF_huc_sf %>%
st_union(),
fill = NA,
color = "gray50") +
#geom_sf(color = river_color) +
geom_sf(data = thresh_df,
aes(color = above_optimum),
size = 1) +
scale_color_manual(values = c("FALSE" = river_color,
"TRUE" = "red")) +
facet_grid(spec_ls ~ scenario) +
theme_classic() +
theme(legend.position = "top",
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank()) +
labs(color = "Above Optimum Temperature")
thresh_p
thresh_p
knitr::opts_chunk$set(
collapse = TRUE,
warning = FALSE,
message = FALSE,
echo = FALSE,
comment = "#>",
fig.path = "../figures/",
dpi = 600
)
options(knitr.kable.NA = '--')
knitr::opts_chunk$set(
collapse = TRUE,
warning = FALSE,
message = FALSE,
echo = FALSE,
comment = "#>",
fig.path = "../figures/",
dpi = 600
)
options(knitr.kable.NA = '--')
# run this if running chunks directly
# for formatting
library(kableExtra)
library(ggpubr)
# for analysis
library(sf)
library(here)
library(tidyverse)
library(magrittr)
library(ggmap)
library(nngeo)
library(janitor)
theme_set(theme_pubr(x.text.angle = 45,
base_size = 8))
knitr::include_graphics("../figures/hab-capac-fig.png")
# NF Salmon QRF extrapolations
load(here("analysis/data/derived_data/NF_qrf_extrapolations.rda"))
# Project area polygons and 200m layer (with habitat attributes) within project area
load(here("analysis/data/derived_data/NF_spatial.rda"))
# Species domains for the NF salmon manually modified in QGIS with expert knowledge from Jessica Buelow - IDFG
NF_crs = st_crs(4326) # WGS84
NF_sp_domain_sf = st_read(here("analysis/data/raw_data/NF_sp_Domain.gpkg"), quiet = TRUE) %>%
st_transform(NF_crs)
NF_sp_domain_df = NF_sp_domain_sf %>%
st_drop_geometry() %>%
as_tibble()
# append correct domains
NF_sum_sf = NF_sum_sf %>%
rename(chnk_strmnt = chnk,
sthd_strmnt = sthd) %>%
left_join(., NF_sp_domain_df %>%
select(c("chnk", "sthd","UniqueID")))
NF_win_sf = NF_win_sf %>%
rename(chnk_strmnt = chnk,
sthd_strmnt = sthd) %>%
left_join(., NF_sp_domain_df %>%
select(c("chnk","sthd","UniqueID")))
NF_redd_sf = NF_redd_sf %>%
rename(chnk_strmnt = chnk,
sthd_strmnt = sthd) %>%
left_join(., NF_sp_domain_df %>%
select(c("chnk","sthd","UniqueID")))
# convert sf objects to tibbles
NF_sum_df = NF_sum_sf %>%
st_drop_geometry() %>%
as_tibble()
NF_win_df = NF_win_sf %>%
st_drop_geometry() %>%
as_tibble()
NF_redd_df = NF_redd_sf %>%
st_drop_geometry() %>%
as_tibble()
